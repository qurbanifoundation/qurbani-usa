---
/**
 * WHITE DONATION BOX TEMPLATE
 *
 * A light-themed donation box with white background and teal accents.
 * Can be used standalone or within any campaign page template.
 *
 * Color Palette:
 * - Background: White
 * - Border/Accent: #01534d (teal)
 * - Button: #01534d (teal)
 */

interface Props {
  campaignSlug?: string;
  campaignTitle?: string;
  campaignImage?: string;
  donationOptions?: Array<{ amount: number; label?: string }>;
  showToggle?: boolean;
  showTrustBadges?: boolean;
  showProgressBar?: boolean;
  progressAmount?: number;
  goalAmount?: number;
  title?: string;
  subtitle?: string;
  className?: string;
}

const {
  campaignSlug = 'general',
  campaignTitle = 'Donation',
  campaignImage = '',
  donationOptions = [
    { amount: 25, label: '' },
    { amount: 50, label: '' },
    { amount: 100, label: '' },
    { amount: 250, label: '' },
  ],
  showToggle = true,
  showTrustBadges = true,
  showProgressBar = false,
  progressAmount = 0,
  goalAmount = 10000,
  title = 'Make a Difference Today',
  subtitle = 'Support Our Cause',
  className = '',
} = Astro.props;

const boxId = `white-box-${Math.random().toString(36).substr(2, 9)}`;
const progressPercent = goalAmount > 0 ? Math.min((progressAmount / goalAmount) * 100, 100) : 0;
---

<div id={boxId} class={`bg-white rounded-2xl p-6 shadow-xl border-2 border-[#01534d] w-full ${className}`} data-donation-box data-template="white">
  <div class="text-center mb-5">
    <p class="text-[#01534d] text-xs font-medium uppercase tracking-wide mb-1">{title}</p>
    <h3 class="text-gray-800 font-bold text-xl" style="font-family: 'Signika', sans-serif;">
      {subtitle}
    </h3>
  </div>

  {showProgressBar && (
    <div class="mb-5">
      <div class="flex justify-between text-sm mb-2">
        <span class="text-gray-600 font-medium">${progressAmount.toLocaleString()} raised</span>
        <span class="text-gray-400">{progressPercent.toFixed(0)}%</span>
      </div>
      <div class="w-full h-2.5 bg-gray-200 rounded-full overflow-hidden">
        <div class="h-full bg-[#01534d] rounded-full transition-all duration-500" style={`width: ${progressPercent}%`}></div>
      </div>
      <p class="text-xs text-gray-400 mt-1">Goal: ${goalAmount.toLocaleString()}</p>
    </div>
  )}

  {showToggle && (
    <div class="flex border-2 border-[#01534d] rounded-xl p-1 mb-5">
      <button type="button" class="donation-type-btn flex-1 py-2.5 px-3 rounded-lg font-semibold bg-[#01534d] text-white transition text-sm" data-type="single">
        One-time
      </button>
      <button type="button" class="donation-type-btn flex-1 py-2.5 px-3 rounded-lg font-semibold text-[#01534d] transition text-sm" data-type="monthly">
        Monthly
      </button>
    </div>
  )}

  <!-- Amount Grid -->
  <div class="grid grid-cols-4 gap-2 mb-5 amount-buttons">
    {donationOptions.slice(0, 4).map((opt, index) => (
      <button
        type="button"
        class="amount-btn py-3 px-2 rounded-lg border-2 font-semibold transition text-center hover:scale-[1.02] border-[#01534d] text-[#01534d] hover:bg-[#01534d]/10"
        data-amount={opt.amount}
      >
        <span class="text-base block">${opt.amount}</span>
      </button>
    ))}
  </div>

  <!-- Custom Amount -->
  <div class="mb-5">
    <div class="relative">
      <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-lg font-bold">$</span>
      <input
        type="number"
        class="custom-amount w-full pl-10 pr-4 py-3 rounded-xl border-2 border-gray-300 bg-white text-gray-800 font-bold focus:outline-none focus:border-[#01534d] text-lg"
        min="1"
        placeholder="Custom amount"
      />
    </div>
  </div>

  <!-- Donate Button -->
  <button
    type="button"
    class="donate-btn w-full bg-[#01534d] text-white font-bold py-4 rounded-xl hover:bg-[#013d39] transition-all text-lg"
    style="font-family: 'Signika', sans-serif;"
  >
    Donate Now
  </button>

  {showTrustBadges && (
    <div class="mt-4 pt-4 border-t border-gray-200">
      <div class="flex justify-center gap-4 text-center">
        <div class="text-gray-400 text-xs flex items-center gap-1">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
          </svg>
          <span>Secure</span>
        </div>
        <div class="text-gray-400 text-xs flex items-center gap-1">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
          </svg>
          <span>Tax Deductible</span>
        </div>
        <div class="text-gray-400 text-xs flex items-center gap-1">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
          </svg>
          <span>100% Policy</span>
        </div>
      </div>
    </div>
  )}
</div>

<script define:vars={{ boxId, campaignSlug, campaignTitle, campaignImage, donationOptions }}>
  document.addEventListener('DOMContentLoaded', function() {
    const box = document.getElementById(boxId);
    if (!box) return;

    let selectedAmount = 0; // No default selection
    let selectedLabel = donationOptions[1]?.label || '';
    let donationType = 'single';

    const typeButtons = box.querySelectorAll('.donation-type-btn');
    const amountButtons = box.querySelectorAll('.amount-btn');
    const customInput = box.querySelector('.custom-amount');
    const donateBtn = box.querySelector('.donate-btn');

    // Type toggle
    typeButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        donationType = this.dataset.type;
        typeButtons.forEach(b => {
          if (b.dataset.type === donationType) {
            b.classList.add('bg-[#01534d]', 'text-white');
            b.classList.remove('text-[#01534d]');
          } else {
            b.classList.remove('bg-[#01534d]', 'text-white');
            b.classList.add('text-[#01534d]');
          }
        });
      });
    });

    // Amount selection
    amountButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        selectedAmount = parseFloat(this.dataset.amount);
        const option = donationOptions.find(o => o.amount === selectedAmount);
        selectedLabel = option ? option.label : '';
        customInput.value = selectedAmount;

        amountButtons.forEach(b => {
          b.classList.remove('bg-[#01534d]', 'text-white', 'selected');
          b.classList.add('text-[#01534d]');
        });
        this.classList.add('bg-[#01534d]', 'text-white', 'selected');
        this.classList.remove('text-[#01534d]');
      });
    });

    // Custom input
    customInput.addEventListener('input', function() {
      if (this.value) {
        selectedAmount = parseFloat(this.value);
        selectedLabel = 'Custom Amount';
        amountButtons.forEach(b => {
          b.classList.remove('bg-[#01534d]', 'text-white', 'selected');
          b.classList.add('text-[#01534d]');
        });
      }
    });

    // Donate button
    donateBtn.addEventListener('click', function() {
      const amount = customInput.value ? parseFloat(customInput.value) : selectedAmount;
      if (!amount || amount < 1) {
        alert('Please enter a valid amount');
        return;
      }

      const itemId = `${campaignSlug}-${amount}-${donationType}`;

      if (window.addToCart) {
        window.addToCart({
          id: itemId,
          name: campaignTitle,
          label: selectedLabel || `$${amount} Donation`,
          amount: amount,
          quantity: 1,
          type: donationType,
          image: campaignImage,
          campaign: campaignSlug
        });
      }
    });

    // Set initial value
    if (customInput && donationOptions[1]) {
      customInput.value = donationOptions[1].amount;
    }
  });
</script>
