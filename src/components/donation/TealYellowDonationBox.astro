---
/**
 * TEAL YELLOW DONATION BOX TEMPLATE
 *
 * A donation box with teal background and yellow accent buttons.
 * Can be used standalone or within any campaign page template.
 *
 * Color Palette:
 * - Background: #255764 (teal)
 * - Accent: #fdc448 (yellow/gold)
 * - Button Text: #61470e (dark gold)
 */

interface Props {
  campaignSlug?: string;
  campaignTitle?: string;
  campaignImage?: string;
  donationOptions?: Array<{ amount: number; label?: string }>;
  showToggle?: boolean;
  showTrustBadges?: boolean;
  title?: string;
  subtitle?: string;
  className?: string;
}

const {
  campaignSlug = 'general',
  campaignTitle = 'Donation',
  campaignImage = '',
  donationOptions = [
    { amount: 50, label: 'Feed a family' },
    { amount: 100, label: 'Provide essentials' },
    { amount: 250, label: 'Emergency aid' },
    { amount: 500, label: 'Transform lives' },
  ],
  showToggle = true,
  showTrustBadges = true,
  title = 'Make a Donation',
  subtitle = '100% reaches those in need',
  className = '',
} = Astro.props;

const boxId = `teal-yellow-box-${Math.random().toString(36).substr(2, 9)}`;
---

<div id={boxId} class={`bg-[#255764] rounded-2xl p-6 shadow-2xl w-full ${className}`} data-donation-box data-template="teal-yellow">
  <div class="text-center mb-5">
    <h3 class="text-xl font-bold text-white mb-1" style="font-family: 'Signika', sans-serif;">
      {title}
    </h3>
    <p class="text-white/70 text-sm">{subtitle}</p>
  </div>

  {showToggle && (
    <div class="flex bg-white/10 rounded-xl p-1 mb-5">
      <button type="button" class="donation-type-btn flex-1 py-2.5 px-3 rounded-lg text-white font-semibold bg-white/20 transition text-sm" data-type="single">
        Single
      </button>
      <button type="button" class="donation-type-btn flex-1 py-2.5 px-3 rounded-lg text-white/70 font-semibold transition text-sm" data-type="monthly">
        Monthly
      </button>
    </div>
  )}

  <!-- Amount Grid -->
  <div class="grid grid-cols-2 gap-2 mb-5 amount-buttons">
    {donationOptions.slice(0, 6).map((opt, index) => (
      <button
        type="button"
        class="amount-btn py-3 px-2 rounded-xl border-2 text-white font-semibold transition text-center hover:scale-[1.02] border-white/30 hover:border-white/50"
        data-amount={opt.amount}
      >
        <span class="text-lg block">${opt.amount.toLocaleString()}</span>
        {opt.label && (
          <span class="block text-xs text-white/70 font-normal mt-0.5 truncate">{opt.label}</span>
        )}
      </button>
    ))}
  </div>

  <!-- Custom Amount -->
  <div class="mb-5">
    <div class="relative">
      <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 text-lg font-bold">$</span>
      <input
        type="number"
        class="custom-amount w-full pl-10 pr-4 py-3 rounded-xl border-2 border-white/30 bg-white text-gray-800 font-bold focus:outline-none focus:border-[#fdc448] text-lg"
        min="1"
        placeholder="Other amount"
      />
    </div>
  </div>

  <!-- Donate Button -->
  <button
    type="button"
    class="donate-btn w-full bg-[#fdc448] text-[#61470e] font-bold py-4 rounded-xl hover:bg-[#efb000] transition-all hover:scale-[1.02] text-lg"
    style="box-shadow: 3px 4px 0 rgba(0,0,0,0.2); font-family: 'Signika', sans-serif;"
  >
    Donate Now
  </button>

  {showTrustBadges && (
    <div class="mt-4 pt-4 border-t border-white/20">
      <div class="flex justify-center gap-4 text-center">
        <div class="text-white/60 text-xs flex items-center gap-1">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"></path>
          </svg>
          <span>Secure</span>
        </div>
        <div class="text-white/60 text-xs flex items-center gap-1">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
          </svg>
          <span>Tax Deductible</span>
        </div>
        <div class="text-white/60 text-xs flex items-center gap-1">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
          </svg>
          <span>100% Policy</span>
        </div>
      </div>
    </div>
  )}
</div>

<script define:vars={{ boxId, campaignSlug, campaignTitle, campaignImage, donationOptions }}>
  document.addEventListener('DOMContentLoaded', function() {
    const box = document.getElementById(boxId);
    if (!box) return;

    let selectedAmount = 0; // No default selection
    let selectedLabel = donationOptions[0]?.label || '';
    let donationType = 'single';

    const typeButtons = box.querySelectorAll('.donation-type-btn');
    const amountButtons = box.querySelectorAll('.amount-btn');
    const customInput = box.querySelector('.custom-amount');
    const donateBtn = box.querySelector('.donate-btn');

    // Type toggle
    typeButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        donationType = this.dataset.type;
        typeButtons.forEach(b => {
          if (b.dataset.type === donationType) {
            b.classList.add('bg-white/20', 'text-white');
            b.classList.remove('text-white/70');
          } else {
            b.classList.remove('bg-white/20', 'text-white');
            b.classList.add('text-white/70');
          }
        });
      });
    });

    // Amount selection
    amountButtons.forEach(btn => {
      btn.addEventListener('click', function() {
        selectedAmount = parseFloat(this.dataset.amount);
        const option = donationOptions.find(o => o.amount === selectedAmount);
        selectedLabel = option ? option.label : '';
        customInput.value = selectedAmount;

        amountButtons.forEach(b => {
          b.classList.remove('border-[#fdc448]', 'bg-[#fdc448]/20', 'selected');
          b.classList.add('border-white/30');
        });
        this.classList.add('border-[#fdc448]', 'bg-[#fdc448]/20', 'selected');
        this.classList.remove('border-white/30');
      });
    });

    // Custom input
    customInput.addEventListener('input', function() {
      if (this.value) {
        selectedAmount = parseFloat(this.value);
        selectedLabel = 'Custom Amount';
        amountButtons.forEach(b => {
          b.classList.remove('border-[#fdc448]', 'bg-[#fdc448]/20', 'selected');
          b.classList.add('border-white/30');
        });
      }
    });

    // Donate button
    donateBtn.addEventListener('click', function() {
      const amount = customInput.value ? parseFloat(customInput.value) : selectedAmount;
      if (!amount || amount < 1) {
        alert('Please enter a valid amount');
        return;
      }

      const itemId = `${campaignSlug}-${amount}-${donationType}`;

      if (window.addToCart) {
        window.addToCart({
          id: itemId,
          name: campaignTitle,
          label: selectedLabel || `$${amount} Donation`,
          amount: amount,
          quantity: 1,
          type: donationType,
          image: campaignImage,
          campaign: campaignSlug
        });
      }
    });

    // Set initial value
    if (customInput && donationOptions[0]) {
      customInput.value = donationOptions[0].amount;
    }
  });
</script>
