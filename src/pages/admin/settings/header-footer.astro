---
import AdminLayout from '../../../layouts/AdminLayout.astro';
import SettingsTabs from '../../../components/admin/SettingsTabs.astro';
import { getSettings } from '../../../lib/settings';

const settings = await getSettings();
---

<AdminLayout title="Header & Footer" activeNav="settings">
  <div class="max-w-4xl">
    <SettingsTabs active="header-footer" />

    <!-- Success Toast -->
    <div id="successToast" class="hidden fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
      </svg>
      <span>Settings saved successfully!</span>
    </div>

    <!-- Error Toast -->
    <div id="errorToast" class="hidden fixed top-4 right-4 bg-red-600 text-white px-6 py-3 rounded-lg shadow-lg z-50 flex items-center gap-2">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
      </svg>
      <span id="errorMessage">Error saving settings</span>
    </div>

    <form id="headerFooterForm">
      <!-- Header Display Settings -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
        <h2 class="text-lg font-bold text-gray-800 mb-6">Header Display</h2>
        <div class="space-y-4">
          <label class="flex items-center justify-between p-4 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition">
            <div>
              <span class="font-medium text-gray-800">Show Top Bar</span>
              <p class="text-sm text-gray-500">Display the phone numbers and language selector above the main navigation</p>
            </div>
            <input
              type="checkbox"
              name="showTopBar"
              id="showTopBar"
              checked={settings.show_top_bar !== false}
              class="w-5 h-5 text-[#01534d] rounded focus:ring-[#01534d]"
            />
          </label>
          <label class="flex items-center justify-between p-4 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100 transition">
            <div>
              <span class="font-medium text-gray-800">Transparent Header</span>
              <p class="text-sm text-gray-500">Make the header transparent so the hero image appears behind the logo and navigation</p>
            </div>
            <input
              type="checkbox"
              name="headerTransparent"
              id="headerTransparent"
              checked={settings.header_transparent === true}
              class="w-5 h-5 text-[#01534d] rounded focus:ring-[#01534d]"
            />
          </label>
        </div>
      </div>

      <!-- Logo & Branding -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
        <h2 class="text-lg font-bold text-gray-800 mb-6">Logo & Branding</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">Site Logo</label>
            <div class="flex flex-col sm:flex-row gap-4">
              <!-- Logo Preview Box -->
              <div class="w-full sm:w-48 h-32 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-300 relative group">
                <img
                  id="logoPreview"
                  src={settings.site_logo}
                  alt="Logo preview"
                  class="max-h-28 max-w-full object-contain"
                  onerror="this.style.display='none'; document.getElementById('logoPlaceholder').style.display='flex';"
                  onload="this.style.display='block'; document.getElementById('logoPlaceholder').style.display='none';"
                />
                <div id="logoPlaceholder" class="hidden flex-col items-center justify-center text-gray-400">
                  <svg class="w-10 h-10 mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                  <span class="text-xs">No logo</span>
                </div>
              </div>

              <!-- Logo Controls -->
              <div class="flex-1 space-y-3">
                <input
                  type="text"
                  name="logo"
                  id="logo"
                  value={settings.site_logo}
                  placeholder="Enter logo URL or upload below"
                  class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent text-sm"
                />
                <div class="flex gap-2">
                  <label class="flex-1 cursor-pointer">
                    <input type="file" id="logoUpload" accept="image/*" class="hidden" />
                    <div class="flex items-center justify-center gap-2 px-4 py-2 bg-[#01534d] text-white rounded-lg hover:bg-[#013d39] transition text-sm font-medium">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                      </svg>
                      Upload Logo
                    </div>
                  </label>
                  <button type="button" id="openGalleryBtn" class="flex-1 flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition text-sm font-medium">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    Gallery
                  </button>
                </div>
                <p class="text-xs text-gray-500">Recommended: PNG or SVG, max 2MB. Transparent background works best.</p>
              </div>
            </div>
            <!-- Upload Progress -->
            <div id="uploadProgress" class="hidden mt-3">
              <div class="flex items-center gap-3">
                <div class="flex-1 bg-gray-200 rounded-full h-2">
                  <div id="uploadProgressBar" class="bg-[#01534d] h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <span id="uploadProgressText" class="text-sm text-gray-600">0%</span>
              </div>
            </div>
          </div>

          <!-- Favicon -->
          <div class="md:col-span-2 pt-4 border-t border-gray-100">
            <label class="block text-sm font-medium text-gray-700 mb-2">Favicon</label>
            <div class="flex flex-col sm:flex-row gap-4">
              <!-- Favicon Preview Box -->
              <div class="w-20 h-20 bg-gray-100 rounded-lg flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-300 relative group">
                <img
                  id="faviconPreview"
                  src={settings.site_favicon}
                  alt="Favicon preview"
                  class="max-h-16 max-w-full object-contain"
                  onerror="this.style.display='none'; document.getElementById('faviconPlaceholder').style.display='flex';"
                  onload="this.style.display='block'; document.getElementById('faviconPlaceholder').style.display='none';"
                />
                <div id="faviconPlaceholder" class="hidden flex-col items-center justify-center text-gray-400">
                  <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                  </svg>
                </div>
              </div>

              <!-- Favicon Controls -->
              <div class="flex-1 space-y-3">
                <input
                  type="text"
                  name="favicon"
                  id="favicon"
                  value={settings.site_favicon}
                  placeholder="Enter favicon URL or upload below"
                  class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent text-sm"
                />
                <div class="flex gap-2">
                  <label class="flex-1 cursor-pointer">
                    <input type="file" id="faviconUpload" accept="image/x-icon,image/png,image/svg+xml,.ico" class="hidden" />
                    <div class="flex items-center justify-center gap-2 px-4 py-2 bg-[#01534d] text-white rounded-lg hover:bg-[#013d39] transition text-sm font-medium">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                      </svg>
                      Upload Favicon
                    </div>
                  </label>
                  <button type="button" id="openFaviconGalleryBtn" class="flex-1 flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition text-sm font-medium">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    Gallery
                  </button>
                </div>
                <p class="text-xs text-gray-500">Recommended: 32x32 or 64x64 pixels. ICO, PNG, or SVG format.</p>
              </div>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Site Name</label>
            <input
              type="text"
              name="siteName"
              id="siteName"
              value={settings.site_name}
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Tagline</label>
            <input
              type="text"
              name="tagline"
              id="tagline"
              value={settings.site_tagline}
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
        </div>
      </div>

      <!-- Top Bar / Contact -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
        <h2 class="text-lg font-bold text-gray-800 mb-6">Contact Information</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
            <input
              type="text"
              name="phone"
              id="phone"
              value={settings.contact_phone}
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Toll-Free Number</label>
            <input
              type="text"
              name="tollFree"
              id="tollFree"
              value={settings.contact_toll_free}
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
            <input
              type="email"
              name="email"
              id="email"
              value={settings.contact_email}
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
        </div>
      </div>

      <!-- Donate Button -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
        <h2 class="text-lg font-bold text-gray-800 mb-6">Donate Button</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Button Text</label>
            <input
              type="text"
              name="donateButtonText"
              value={settings.donate_button_text}
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Button Link</label>
            <input
              type="text"
              name="donateButtonHref"
              value={settings.donate_button_href}
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Button Color</label>
            <div class="flex gap-2">
              <input
                type="color"
                name="donateButtonColor"
                value={settings.donate_button_color}
                class="w-12 h-10 rounded border border-gray-200 cursor-pointer"
              />
              <input
                type="text"
                value={settings.donate_button_color}
                class="flex-1 px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
                readonly
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Footer Content -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
        <h2 class="text-lg font-bold text-gray-800 mb-6">Footer Content</h2>
        <div class="space-y-6">
          <!-- Footer Logo -->
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Footer Logo</label>
            <p class="text-xs text-gray-500 mb-3">Leave empty to use the header logo</p>
            <div class="flex flex-col sm:flex-row gap-4">
              <!-- Footer Logo Preview Box -->
              <div class="w-full sm:w-48 h-24 bg-gray-800 rounded-lg flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-600 relative group">
                <img
                  id="footerLogoPreview"
                  src={settings.footer_logo || settings.site_logo}
                  alt="Footer logo preview"
                  class="max-h-20 max-w-full object-contain"
                  onerror="this.style.display='none'; document.getElementById('footerLogoPlaceholder').style.display='flex';"
                  onload="this.style.display='block'; document.getElementById('footerLogoPlaceholder').style.display='none';"
                />
                <div id="footerLogoPlaceholder" class="hidden flex-col items-center justify-center text-gray-400">
                  <svg class="w-8 h-8 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                  <span class="text-xs">No logo</span>
                </div>
              </div>

              <!-- Footer Logo Controls -->
              <div class="flex-1 space-y-3">
                <input
                  type="text"
                  name="footerLogo"
                  id="footerLogo"
                  value={settings.footer_logo}
                  placeholder="Enter footer logo URL or upload below"
                  class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent text-sm"
                />
                <div class="flex gap-2">
                  <label class="flex-1 cursor-pointer">
                    <input type="file" id="footerLogoUpload" accept="image/*" class="hidden" />
                    <div class="flex items-center justify-center gap-2 px-4 py-2 bg-[#01534d] text-white rounded-lg hover:bg-[#013d39] transition text-sm font-medium">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path>
                      </svg>
                      Upload
                    </div>
                  </label>
                  <button type="button" id="openFooterLogoGalleryBtn" class="flex-1 flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition text-sm font-medium">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    Gallery
                  </button>
                  <button type="button" id="clearFooterLogoBtn" class="px-3 py-2 border border-gray-300 text-gray-500 rounded-lg hover:bg-gray-50 transition text-sm" title="Use header logo">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                  </button>
                </div>
                <p class="text-xs text-gray-500">For dark footer backgrounds, use a light/white version of your logo</p>
              </div>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">About Text</label>
            <textarea
              name="footerAbout"
              rows="3"
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            >{settings.footer_about}</textarea>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">EIN Number</label>
              <input
                type="text"
                name="ein"
                value={settings.footer_ein}
                class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Copyright Text</label>
              <input
                type="text"
                name="copyright"
                value={settings.footer_copyright}
                class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Social Media -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
        <h2 class="text-lg font-bold text-gray-800 mb-6">Social Media Links</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Facebook</label>
            <input
              type="url"
              name="facebook"
              value={settings.social_facebook}
              placeholder="https://facebook.com/..."
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">YouTube</label>
            <input
              type="url"
              name="youtube"
              value={settings.social_youtube}
              placeholder="https://youtube.com/..."
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Instagram</label>
            <input
              type="url"
              name="instagram"
              value={settings.social_instagram}
              placeholder="https://instagram.com/..."
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Twitter / X</label>
            <input
              type="url"
              name="twitter"
              value={settings.social_twitter}
              placeholder="https://twitter.com/..."
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
        </div>
      </div>

      <!-- Address -->
      <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6 mb-6">
        <h2 class="text-lg font-bold text-gray-800 mb-6">Address</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="md:col-span-2">
            <label class="block text-sm font-medium text-gray-700 mb-2">Street Address</label>
            <input
              type="text"
              name="street"
              value={settings.contact_address_street}
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
            <input
              type="text"
              name="city"
              value={settings.contact_address_city}
              class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
            />
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
              <input
                type="text"
                name="state"
                value={settings.contact_address_state}
                class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ZIP</label>
              <input
                type="text"
                name="zip"
                value={settings.contact_address_zip}
                class="w-full px-4 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#01534d] focus:border-transparent"
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Save Button -->
      <div class="flex justify-end gap-4">
        <button type="button" id="cancelBtn" class="px-6 py-2 border border-gray-200 rounded-lg font-medium text-gray-700 hover:bg-gray-50 transition bg-white">
          Cancel
        </button>
        <button type="submit" id="saveBtn">
          <span>Save Changes</span>
          <svg id="saveSpinner" class="hidden w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </button>
      </div>
    </form>

    <!-- Media Gallery Modal -->
    <div id="galleryModal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[80vh] overflow-hidden">
        <div class="flex items-center justify-between p-4 border-b">
          <h3 class="text-lg font-bold text-gray-800">Select from Gallery</h3>
          <button type="button" id="closeGalleryBtn" class="text-gray-400 hover:text-gray-600">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
        <div class="p-4 overflow-y-auto" style="max-height: calc(80vh - 130px);">
          <div id="galleryLoading" class="flex items-center justify-center py-12">
            <svg class="w-8 h-8 animate-spin text-[#01534d]" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
          </div>
          <div id="galleryEmpty" class="hidden text-center py-12 text-gray-500">
            <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
            </svg>
            <p class="font-medium">No images yet</p>
            <p class="text-sm">Upload your first image using the Upload button</p>
          </div>
          <div id="galleryGrid" class="hidden grid grid-cols-3 sm:grid-cols-4 gap-3"></div>
        </div>
        <div class="p-4 border-t bg-gray-50 flex justify-end gap-3">
          <button type="button" id="cancelGalleryBtn" class="px-4 py-2 text-gray-600 hover:text-gray-800">Cancel</button>
          <button type="button" id="selectImageBtn" disabled class="px-4 py-2 bg-[#01534d] text-white rounded-lg hover:bg-[#013d39] disabled:opacity-50 disabled:cursor-not-allowed">
            Select Image
          </button>
        </div>
      </div>
    </div>
  </div>
</AdminLayout>

<style>
  #saveBtn {
    background-color: #01534d !important;
    color: white !important;
    padding: 0.5rem 1.5rem !important;
    border-radius: 0.5rem !important;
    font-weight: 500 !important;
    display: inline-flex !important;
    align-items: center !important;
    gap: 0.5rem !important;
    cursor: pointer !important;
    border: none !important;
    transition: background-color 0.2s !important;
  }
  #saveBtn:hover {
    background-color: #013d39 !important;
  }
  #saveBtn:disabled {
    opacity: 0.7 !important;
    cursor: not-allowed !important;
  }
</style>

<script>
  // Logo elements
  const logoInput = document.getElementById('logo') as HTMLInputElement;
  const logoPreview = document.getElementById('logoPreview') as HTMLImageElement;
  const logoPlaceholder = document.getElementById('logoPlaceholder') as HTMLElement;
  const logoUpload = document.getElementById('logoUpload') as HTMLInputElement;
  const uploadProgress = document.getElementById('uploadProgress') as HTMLElement;
  const uploadProgressBar = document.getElementById('uploadProgressBar') as HTMLElement;
  const uploadProgressText = document.getElementById('uploadProgressText') as HTMLElement;

  // Favicon elements
  const faviconInput = document.getElementById('favicon') as HTMLInputElement;
  const faviconPreview = document.getElementById('faviconPreview') as HTMLImageElement;
  const faviconPlaceholder = document.getElementById('faviconPlaceholder') as HTMLElement;
  const faviconUpload = document.getElementById('faviconUpload') as HTMLInputElement;
  const openFaviconGalleryBtn = document.getElementById('openFaviconGalleryBtn') as HTMLButtonElement;

  // Footer Logo elements
  const footerLogoInput = document.getElementById('footerLogo') as HTMLInputElement;
  const footerLogoPreview = document.getElementById('footerLogoPreview') as HTMLImageElement;
  const footerLogoPlaceholder = document.getElementById('footerLogoPlaceholder') as HTMLElement;
  const footerLogoUpload = document.getElementById('footerLogoUpload') as HTMLInputElement;
  const openFooterLogoGalleryBtn = document.getElementById('openFooterLogoGalleryBtn') as HTMLButtonElement;
  const clearFooterLogoBtn = document.getElementById('clearFooterLogoBtn') as HTMLButtonElement;

  // Gallery elements
  const openGalleryBtn = document.getElementById('openGalleryBtn') as HTMLButtonElement;
  const galleryModal = document.getElementById('galleryModal') as HTMLElement;
  const closeGalleryBtn = document.getElementById('closeGalleryBtn') as HTMLButtonElement;
  const cancelGalleryBtn = document.getElementById('cancelGalleryBtn') as HTMLButtonElement;
  const selectImageBtn = document.getElementById('selectImageBtn') as HTMLButtonElement;
  const galleryGrid = document.getElementById('galleryGrid') as HTMLElement;
  const galleryLoading = document.getElementById('galleryLoading') as HTMLElement;
  const galleryEmpty = document.getElementById('galleryEmpty') as HTMLElement;

  let selectedGalleryImage: string | null = null;
  let selectingFavicon = false;
  let selectingFooterLogo = false;

  // Update logo preview
  function updateLogoPreview(url: string) {
    if (url && logoPreview) {
      logoPreview.src = url;
      logoPreview.style.display = 'block';
      if (logoPlaceholder) logoPlaceholder.style.display = 'none';
    } else {
      if (logoPreview) logoPreview.style.display = 'none';
      if (logoPlaceholder) logoPlaceholder.style.display = 'flex';
    }
  }

  // Logo URL input change
  logoInput?.addEventListener('input', () => {
    updateLogoPreview(logoInput.value);
  });

  // Favicon preview update
  function updateFaviconPreview(url: string) {
    if (url && faviconPreview) {
      faviconPreview.src = url;
      faviconPreview.style.display = 'block';
      if (faviconPlaceholder) faviconPlaceholder.style.display = 'none';
    } else {
      if (faviconPreview) faviconPreview.style.display = 'none';
      if (faviconPlaceholder) faviconPlaceholder.style.display = 'flex';
    }
  }

  // Favicon URL input change
  faviconInput?.addEventListener('input', () => {
    updateFaviconPreview(faviconInput.value);
  });

  // Favicon upload handler
  faviconUpload?.addEventListener('change', async (e) => {
    const file = (e.target as HTMLInputElement).files?.[0];
    if (!file) return;

    // Validate file
    const validTypes = ['image/x-icon', 'image/png', 'image/svg+xml', 'image/vnd.microsoft.icon'];
    if (!validTypes.includes(file.type) && !file.name.endsWith('.ico')) {
      alert('Please select an ICO, PNG, or SVG file');
      return;
    }
    if (file.size > 1 * 1024 * 1024) {
      alert('File size must be less than 1MB');
      return;
    }

    try {
      const formData = new FormData();
      formData.append('file', file);

      const response = await fetch('/api/media/upload', {
        method: 'POST',
        body: formData
      });

      const result = await response.json();

      if (!response.ok || !result.success) {
        throw new Error(result.error || 'Upload failed');
      }

      faviconInput.value = result.url;
      updateFaviconPreview(result.url);
    } catch (error) {
      console.error('Upload error:', error);
      alert('Failed to upload favicon. Please try again.');
    }
  });

  // Footer logo preview update
  function updateFooterLogoPreview(url: string) {
    if (url && footerLogoPreview) {
      footerLogoPreview.src = url;
      footerLogoPreview.style.display = 'block';
      if (footerLogoPlaceholder) footerLogoPlaceholder.style.display = 'none';
    } else {
      // Fall back to header logo if no footer logo
      const headerLogo = logoInput?.value;
      if (headerLogo && footerLogoPreview) {
        footerLogoPreview.src = headerLogo;
        footerLogoPreview.style.display = 'block';
        if (footerLogoPlaceholder) footerLogoPlaceholder.style.display = 'none';
      } else {
        if (footerLogoPreview) footerLogoPreview.style.display = 'none';
        if (footerLogoPlaceholder) footerLogoPlaceholder.style.display = 'flex';
      }
    }
  }

  // Footer logo URL input change
  footerLogoInput?.addEventListener('input', () => {
    updateFooterLogoPreview(footerLogoInput.value);
  });

  // Footer logo upload handler
  footerLogoUpload?.addEventListener('change', async (e) => {
    const file = (e.target as HTMLInputElement).files?.[0];
    if (!file) return;

    if (!file.type.startsWith('image/')) {
      alert('Please select an image file');
      return;
    }
    if (file.size > 2 * 1024 * 1024) {
      alert('File size must be less than 2MB');
      return;
    }

    try {
      const formData = new FormData();
      formData.append('file', file);

      const response = await fetch('/api/media/upload', {
        method: 'POST',
        body: formData
      });

      const result = await response.json();

      if (!response.ok || !result.success) {
        throw new Error(result.error || 'Upload failed');
      }

      footerLogoInput.value = result.url;
      updateFooterLogoPreview(result.url);
    } catch (error) {
      console.error('Upload error:', error);
      alert('Failed to upload image. Please try again.');
    }
  });

  // Clear footer logo (use header logo instead)
  clearFooterLogoBtn?.addEventListener('click', () => {
    footerLogoInput.value = '';
    updateFooterLogoPreview('');
  });

  // Footer logo gallery - reuse the same modal
  openFooterLogoGalleryBtn?.addEventListener('click', async () => {
    selectingFavicon = false;
    selectingFooterLogo = true;
    galleryModal.classList.remove('hidden');
    galleryLoading.classList.remove('hidden');
    galleryGrid.classList.add('hidden');
    galleryEmpty.classList.add('hidden');
    selectedGalleryImage = null;
    selectImageBtn.disabled = true;

    try {
      const response = await fetch('/api/media/list');
      const result = await response.json();

      galleryLoading.classList.add('hidden');

      if (!result.images || result.images.length === 0) {
        galleryEmpty.classList.remove('hidden');
        return;
      }

      galleryGrid.innerHTML = result.images.map((img: any) => `
        <div class="gallery-item-wrapper relative group aspect-square">
          <button type="button" class="gallery-item w-full h-full rounded-lg border-2 border-transparent hover:border-[#01534d] overflow-hidden bg-gray-100 focus:outline-none focus:border-[#01534d] transition" data-url="${img.url}" data-name="${img.name}">
            <img src="${img.url}" alt="${img.name}" class="w-full h-full object-contain p-2" loading="lazy" />
          </button>
          <button type="button" class="delete-gallery-img absolute top-1 right-1 p-1.5 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700" data-name="${img.name}" title="Delete image">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      `).join('');

      galleryGrid.classList.remove('hidden');

      document.querySelectorAll('.gallery-item').forEach(item => {
        item.addEventListener('click', () => {
          document.querySelectorAll('.gallery-item').forEach(i => i.classList.remove('border-[#01534d]', 'ring-2', 'ring-[#01534d]'));
          item.classList.add('border-[#01534d]', 'ring-2', 'ring-[#01534d]');
          selectedGalleryImage = (item as HTMLElement).dataset.url || null;
          selectImageBtn.disabled = false;
        });
      });

      document.querySelectorAll('.delete-gallery-img').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.stopPropagation();
          const filename = (btn as HTMLElement).dataset.name;
          if (!filename) return;

          if (!confirm('Delete this image? This cannot be undone.')) return;

          try {
            const response = await fetch('/api/media/delete', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ filename })
            });

            const result = await response.json();

            if (result.success) {
              const wrapper = btn.closest('.gallery-item-wrapper');
              wrapper?.remove();
              if (galleryGrid.children.length === 0) {
                galleryGrid.classList.add('hidden');
                galleryEmpty.classList.remove('hidden');
              }
            } else {
              alert(result.error || 'Failed to delete image');
            }
          } catch (error) {
            console.error('Delete error:', error);
            alert('Failed to delete image');
          }
        });
      });

    } catch (error) {
      console.error('Gallery error:', error);
      galleryLoading.classList.add('hidden');
      galleryEmpty.classList.remove('hidden');
    }
  });

  // Favicon gallery - reuse the same modal
  openFaviconGalleryBtn?.addEventListener('click', async () => {
    selectingFavicon = true;
    galleryModal.classList.remove('hidden');
    galleryLoading.classList.remove('hidden');
    galleryGrid.classList.add('hidden');
    galleryEmpty.classList.add('hidden');
    selectedGalleryImage = null;
    selectImageBtn.disabled = true;

    try {
      const response = await fetch('/api/media/list');
      const result = await response.json();

      galleryLoading.classList.add('hidden');

      if (!result.images || result.images.length === 0) {
        galleryEmpty.classList.remove('hidden');
        return;
      }

      // Render gallery grid with delete buttons
      galleryGrid.innerHTML = result.images.map((img: any) => `
        <div class="gallery-item-wrapper relative group aspect-square">
          <button type="button" class="gallery-item w-full h-full rounded-lg border-2 border-transparent hover:border-[#01534d] overflow-hidden bg-gray-100 focus:outline-none focus:border-[#01534d] transition" data-url="${img.url}" data-name="${img.name}">
            <img src="${img.url}" alt="${img.name}" class="w-full h-full object-contain p-2" loading="lazy" />
          </button>
          <button type="button" class="delete-gallery-img absolute top-1 right-1 p-1.5 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700" data-name="${img.name}" title="Delete image">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      `).join('');

      galleryGrid.classList.remove('hidden');

      // Add click handlers for selection
      document.querySelectorAll('.gallery-item').forEach(item => {
        item.addEventListener('click', () => {
          document.querySelectorAll('.gallery-item').forEach(i => i.classList.remove('border-[#01534d]', 'ring-2', 'ring-[#01534d]'));
          item.classList.add('border-[#01534d]', 'ring-2', 'ring-[#01534d]');
          selectedGalleryImage = (item as HTMLElement).dataset.url || null;
          selectImageBtn.disabled = false;
        });
      });

      // Add delete handlers
      document.querySelectorAll('.delete-gallery-img').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.stopPropagation();
          const filename = (btn as HTMLElement).dataset.name;
          if (!filename) return;

          if (!confirm('Delete this image? This cannot be undone.')) return;

          try {
            const response = await fetch('/api/media/delete', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ filename })
            });

            const result = await response.json();

            if (result.success) {
              const wrapper = btn.closest('.gallery-item-wrapper');
              wrapper?.remove();

              if (galleryGrid.children.length === 0) {
                galleryGrid.classList.add('hidden');
                galleryEmpty.classList.remove('hidden');
              }
            } else {
              alert(result.error || 'Failed to delete image');
            }
          } catch (error) {
            console.error('Delete error:', error);
            alert('Failed to delete image');
          }
        });
      });

    } catch (error) {
      console.error('Gallery error:', error);
      galleryLoading.classList.add('hidden');
      galleryEmpty.classList.remove('hidden');
    }
  });

  // Logo upload handler
  logoUpload?.addEventListener('change', async (e) => {
    const file = (e.target as HTMLInputElement).files?.[0];
    if (!file) return;

    // Validate file
    if (!file.type.startsWith('image/')) {
      alert('Please select an image file');
      return;
    }
    if (file.size > 2 * 1024 * 1024) {
      alert('File size must be less than 2MB');
      return;
    }

    // Show progress
    uploadProgress.classList.remove('hidden');
    uploadProgressBar.style.width = '0%';
    uploadProgressText.textContent = 'Uploading...';

    try {
      // Create form data
      const formData = new FormData();
      formData.append('file', file);

      // Simulate progress
      let progress = 0;
      const progressInterval = setInterval(() => {
        progress += 15;
        if (progress <= 90) {
          uploadProgressBar.style.width = `${progress}%`;
        }
      }, 150);

      // Upload via API
      const response = await fetch('/api/media/upload', {
        method: 'POST',
        body: formData
      });

      clearInterval(progressInterval);
      const result = await response.json();

      if (!response.ok || !result.success) {
        throw new Error(result.error || 'Upload failed');
      }

      // Update progress to 100%
      uploadProgressBar.style.width = '100%';
      uploadProgressText.textContent = 'Done!';

      // Update input and preview
      logoInput.value = result.url;
      updateLogoPreview(result.url);

      // Hide progress after a moment
      setTimeout(() => {
        uploadProgress.classList.add('hidden');
      }, 1000);

    } catch (error) {
      console.error('Upload error:', error);
      alert('Failed to upload image. Please try again.');
      uploadProgress.classList.add('hidden');
    }
  });

  // Open gallery modal (for logo)
  openGalleryBtn?.addEventListener('click', async () => {
    selectingFavicon = false;
    galleryModal.classList.remove('hidden');
    galleryLoading.classList.remove('hidden');
    galleryGrid.classList.add('hidden');
    galleryEmpty.classList.add('hidden');
    selectedGalleryImage = null;
    selectImageBtn.disabled = true;

    try {
      // Fetch images via API
      const response = await fetch('/api/media/list');
      const result = await response.json();

      galleryLoading.classList.add('hidden');

      if (!result.images || result.images.length === 0) {
        galleryEmpty.classList.remove('hidden');
        return;
      }

      // Render gallery grid with delete buttons
      galleryGrid.innerHTML = result.images.map((img: any) => `
        <div class="gallery-item-wrapper relative group aspect-square">
          <button type="button" class="gallery-item w-full h-full rounded-lg border-2 border-transparent hover:border-[#01534d] overflow-hidden bg-gray-100 focus:outline-none focus:border-[#01534d] transition" data-url="${img.url}" data-name="${img.name}">
            <img src="${img.url}" alt="${img.name}" class="w-full h-full object-contain p-2" loading="lazy" />
          </button>
          <button type="button" class="delete-gallery-img absolute top-1 right-1 p-1.5 bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-700" data-name="${img.name}" title="Delete image">
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>
      `).join('');

      galleryGrid.classList.remove('hidden');

      // Add click handlers for selection
      document.querySelectorAll('.gallery-item').forEach(item => {
        item.addEventListener('click', () => {
          document.querySelectorAll('.gallery-item').forEach(i => i.classList.remove('border-[#01534d]', 'ring-2', 'ring-[#01534d]'));
          item.classList.add('border-[#01534d]', 'ring-2', 'ring-[#01534d]');
          selectedGalleryImage = (item as HTMLElement).dataset.url || null;
          selectImageBtn.disabled = false;
        });
      });

      // Add delete handlers
      document.querySelectorAll('.delete-gallery-img').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          e.stopPropagation();
          const filename = (btn as HTMLElement).dataset.name;
          if (!filename) return;

          if (!confirm(`Are you sure you want to delete this image? This cannot be undone.`)) {
            return;
          }

          try {
            const response = await fetch('/api/media/delete', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ filename })
            });

            const result = await response.json();

            if (result.success) {
              // Remove from grid
              const wrapper = btn.closest('.gallery-item-wrapper');
              wrapper?.remove();

              // Check if gallery is now empty
              if (galleryGrid.children.length === 0) {
                galleryGrid.classList.add('hidden');
                galleryEmpty.classList.remove('hidden');
              }
            } else {
              alert(result.error || 'Failed to delete image');
            }
          } catch (error) {
            console.error('Delete error:', error);
            alert('Failed to delete image');
          }
        });
      });

    } catch (error) {
      console.error('Gallery error:', error);
      galleryLoading.classList.add('hidden');
      galleryEmpty.classList.remove('hidden');
    }
  });

  // Close gallery
  const closeGallery = () => {
    galleryModal.classList.add('hidden');
    selectedGalleryImage = null;
    selectingFavicon = false;
    selectingFooterLogo = false;
  };
  closeGalleryBtn?.addEventListener('click', closeGallery);
  cancelGalleryBtn?.addEventListener('click', closeGallery);
  galleryModal?.addEventListener('click', (e) => {
    if (e.target === galleryModal) closeGallery();
  });

  // Select image from gallery
  selectImageBtn?.addEventListener('click', () => {
    if (selectedGalleryImage) {
      if (selectingFavicon) {
        faviconInput.value = selectedGalleryImage;
        updateFaviconPreview(selectedGalleryImage);
      } else if (selectingFooterLogo) {
        footerLogoInput.value = selectedGalleryImage;
        updateFooterLogoPreview(selectedGalleryImage);
      } else {
        logoInput.value = selectedGalleryImage;
        updateLogoPreview(selectedGalleryImage);
      }
      selectingFavicon = false;
      selectingFooterLogo = false;
      closeGallery();
    }
  });

  // Color picker sync
  const colorInput = document.querySelector('input[name="donateButtonColor"]') as HTMLInputElement;
  const colorText = colorInput?.nextElementSibling?.nextElementSibling as HTMLInputElement;
  colorInput?.addEventListener('input', () => {
    if (colorText) colorText.value = colorInput.value;
  });

  // Form submission
  const form = document.getElementById('headerFooterForm') as HTMLFormElement;
  const saveBtn = document.getElementById('saveBtn') as HTMLButtonElement;
  const saveSpinner = document.getElementById('saveSpinner') as HTMLElement;
  const successToast = document.getElementById('successToast') as HTMLElement;
  const errorToast = document.getElementById('errorToast') as HTMLElement;
  const errorMessage = document.getElementById('errorMessage') as HTMLElement;

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Show loading state
    saveBtn.disabled = true;
    saveSpinner.classList.remove('hidden');

    // Collect form data
    const formData = new FormData(form);
    const settings: Record<string, any> = {};

    formData.forEach((value, key) => {
      settings[key] = value;
    });

    // Handle checkboxes explicitly (unchecked ones aren't in FormData)
    const showTopBar = document.getElementById('showTopBar') as HTMLInputElement;
    const headerTransparent = document.getElementById('headerTransparent') as HTMLInputElement;
    settings.showTopBar = showTopBar?.checked || false;
    settings.headerTransparent = headerTransparent?.checked || false;

    try {
      const response = await fetch('/api/settings', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(settings),
      });

      const result = await response.json();

      if (result.success) {
        // Show success toast
        successToast.classList.remove('hidden');
        setTimeout(() => {
          successToast.classList.add('hidden');
        }, 3000);

        // Reload page to show updated values
        setTimeout(() => {
          window.location.reload();
        }, 1500);
      } else {
        // Show error toast
        errorMessage.textContent = result.error || 'Failed to save settings';
        errorToast.classList.remove('hidden');
        setTimeout(() => {
          errorToast.classList.add('hidden');
        }, 5000);
      }
    } catch (error) {
      console.error('Error:', error);
      errorMessage.textContent = 'Network error. Please try again.';
      errorToast.classList.remove('hidden');
      setTimeout(() => {
        errorToast.classList.add('hidden');
      }, 5000);
    }

    // Hide loading state
    saveBtn.disabled = false;
    saveSpinner.classList.add('hidden');
  });

  // Cancel button
  document.getElementById('cancelBtn')?.addEventListener('click', () => {
    window.location.reload();
  });
</script>
